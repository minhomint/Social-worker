<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ Overnight JangMinHo Live Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            min-height: 100vh;
        }
        .gradient-text {
            background: linear-gradient(to right, #14b8a6, #06b6d4, #0ea5e9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- ê³ ì • í—¤ë” -->
    <div class="sticky top-0 z-50 glass-effect border-b border-teal-200 shadow-xl">
        <div class="p-4">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-2">
                    <div class="bg-gradient-to-r from-teal-400 to-cyan-400 p-2 rounded-lg shadow-lg">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-base font-bold text-gray-800">ğŸµ Overnight Live</h1>
                        <p class="text-xs text-teal-600">ì‹¤ì‹œê°„ ì¡°íšŒìˆ˜ ì¶”ì </p>
                    </div>
                </div>
                
                <!-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
                <button onclick="manualRefresh()" class="bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-bold py-2 px-4 rounded-lg shadow-lg hover:shadow-xl transition-all">
                    ğŸ”„ ìƒˆë¡œê³ ì¹¨
                </button>
            </div>

            <!-- ë·° ëª¨ë“œ ì „í™˜ -->
            <div class="flex gap-2 mb-3">
                <button id="cardViewBtn" onclick="setViewMode('card')" class="flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-gradient-to-r from-teal-400 to-cyan-400 text-white shadow-lg">
                    ì¹´ë“œë·°
                </button>
                <button id="tableViewBtn" onclick="setViewMode('table')" class="flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-white text-gray-600 shadow">
                    í…Œì´ë¸”ë·°
                </button>
            </div>

            <!-- ìƒíƒœ í‘œì‹œ -->
            <div class="grid grid-cols-2 gap-2 mb-3">
                <div class="bg-gradient-to-br from-teal-50 to-cyan-50 border-2 border-teal-300 rounded-lg p-2 text-center shadow">
                    <div class="text-xs text-teal-700 font-semibold">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</div>
                    <div class="text-sm font-black text-teal-600" id="lastUpdate">--:--</div>
                </div>
                <div class="bg-gradient-to-br from-emerald-50 to-green-50 border-2 border-emerald-300 rounded-lg p-2 text-center shadow">
                    <div class="text-xs text-emerald-700 font-semibold">ì˜ìƒ ìˆ˜</div>
                    <div class="text-sm font-black text-emerald-600" id="videoCount">0</div>
                </div>
            </div>

            <!-- ì—°ê²° ìƒíƒœ -->
            <div class="text-center">
                <span id="connectionStatus" class="text-xs text-gray-500">ì¤€ë¹„ ì¤‘...</span>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="p-4">
        <!-- ë°ìŠ¤í¬í†±: 2ë‹¨ ë ˆì´ì•„ì›ƒ / ëª¨ë°”ì¼: ì„¸ë¡œ ìŠ¤íƒ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <!-- ì™¼ìª½: íŠ¸ë˜ì»¤ -->
            <div>
                <div class="glass-effect border-2 border-teal-300 rounded-2xl p-4 shadow-lg mb-4">
                    <h2 class="text-lg font-bold text-gray-800 mb-2">ğŸ“Š ì¡°íšŒìˆ˜ ì¶”ì </h2>
                    <p class="text-xs text-gray-600">YouTube APIë¡œ ì‹¤ì‹œê°„ ì¡°íšŒìˆ˜ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤</p>
                </div>

                <!-- ì¹´ë“œ ë·° -->
                <div id="cardView" class="space-y-3"></div>
                
                <!-- í…Œì´ë¸” ë·° -->
                <div id="tableView" class="hidden"></div>

                <!-- ë²„íŠ¼ë“¤ -->
                <div class="mt-6 grid grid-cols-2 gap-2">
                    <button onclick="loadPlaylist()" class="bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-xl transition-all">
                        ğŸ“‹ ì¬ìƒëª©ë¡ ë¡œë“œ
                    </button>
                    <button onclick="saveToFirebase()" class="bg-gradient-to-r from-pink-400 to-rose-400 text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-xl transition-all">
                        ğŸ’¾ Firebase ì €ì¥
                    </button>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ì¬ìƒëª©ë¡ í”Œë ˆì´ì–´ -->
            <div class="lg:sticky lg:top-24 lg:self-start">
                <div class="glass-effect border-2 border-teal-300 rounded-2xl p-4 shadow-lg mb-4">
                    <h2 class="text-lg font-bold text-gray-800 mb-2">ğŸµ í˜„ì¬ ì¬ìƒëª©ë¡</h2>
                    <p class="text-xs text-gray-600 mb-3">Overnight JangMinHo ì¬ìƒëª©ë¡</p>
                    
                    <!-- YouTube í”Œë ˆì´ì–´ -->
                    <div class="relative" style="padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 15px; box-shadow: 0 10px 30px rgba(45, 212, 191, 0.3);">
                        <iframe 
                            id="player" 
                            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"
                            src="https://www.youtube.com/embed/videoseries?list=PLfuYGpnnSBu24ryeO51pagt62smucmmGv&autoplay=0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                            allowfullscreen>
                        </iframe>
                    </div>

                    <!-- ì¬ìƒëª©ë¡ ì •ë³´ -->
                    <div class="mt-4 p-3 bg-gradient-to-br from-teal-50 to-cyan-50 rounded-lg border-2 border-teal-200">
                        <div class="text-xs text-gray-700 space-y-1">
                            <div class="font-semibold text-gray-800">ì¬ìƒëª©ë¡ ì •ë³´</div>
                            <div>â€¢ ID: PLfuYGpnnSBu24ryeO51pagt62smucmmGv</div>
                            <div>â€¢ ìë™ ì—°ì† ì¬ìƒ</div>
                        </div>
                    </div>

                    <!-- YouTubeì—ì„œ ì—´ê¸° -->
                    <button onclick="openInYoutube()" class="mt-3 w-full bg-gradient-to-r from-red-500 to-rose-500 text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-xl transition-all">
                        ğŸ“º YouTubeì—ì„œ ì—´ê¸°
                    </button>
                </div>

                <!-- ì•ˆë‚´ -->
                <div class="glass-effect border-2 border-teal-300 rounded-2xl p-4 shadow-lg">
                    <div class="flex items-start gap-3">
                        <svg class="w-5 h-5 text-teal-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <div class="text-sm text-gray-700">
                            <div class="font-semibold text-gray-900 mb-2">ğŸ“Š ì‚¬ìš© ë°©ë²•</div>
                            <div class="text-xs space-y-1">
                                <div>â€¢ <strong>ì¬ìƒëª©ë¡ ë¡œë“œ</strong>: YouTube APIë¡œ ì˜ìƒ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</div>
                                <div>â€¢ <strong>ìƒˆë¡œê³ ì¹¨</strong>: ìµœì‹  ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸</div>
                                <div>â€¢ <strong>ë³€í™”ëŸ‰ ì¶”ì </strong>: ì´ì „ ì¡°íšŒìˆ˜ì™€ ë¹„êµ</div>
                                <div>â€¢ <strong>Firebase ì €ì¥</strong>: ì‹œê°„ëŒ€ë³„ ê¸°ë¡ ë³´ê´€</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyBDOcjC6DNtM-8xQS6PNZqV7yAFq4PMCR8",
            authDomain: "always-88981.firebaseapp.com",
            projectId: "always-88981",
            storageBucket: "always-88981.firebasestorage.app",
            messagingSenderId: "915000956041",
            appId: "1:915000956041:web:490e0668c560aafd0e6258",
            measurementId: "G-WRWS6GGV8L",
            databaseURL: "https://always-88981-default-rtdb.firebaseio.com"
        };

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // YouTube API ì„¤ì •
        const YOUTUBE_API_KEY = 'AIzaSyBuoonh-2xdqGo8nQfrTEQBeNDfoL-udfU';
        const PLAYLIST_ID = 'PLfuYGpnnSBu24ryeO51pagt62smucmmGv';

        let currentViewMode = 'card';
        let videosData = [];
        let previousData = {}; // ì´ì „ ì¡°íšŒìˆ˜ ì €ì¥

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(message, color = 'text-teal-600') {
            const status = document.getElementById('connectionStatus');
            status.textContent = message;
            status.className = `text-xs font-semibold ${color}`;
        }

        // ì‹œê°„ í¬ë§·
        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // ì¬ìƒëª©ë¡ ë¹„ë””ì˜¤ ID ê°€ì ¸ì˜¤ê¸°
        async function fetchPlaylistVideos() {
            updateStatus('ì¬ìƒëª©ë¡ ë¡œë”© ì¤‘...', 'text-blue-600 pulse');
            
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${PLAYLIST_ID}&key=${YOUTUBE_API_KEY}`
                );
                
                if (!response.ok) {
                    throw new Error('API ìš”ì²­ ì‹¤íŒ¨: ' + response.status);
                }
                
                const data = await response.json();
                const videoIds = data.items.map(item => item.snippet.resourceId.videoId);
                
                return videoIds;
            } catch (error) {
                console.error('ì¬ìƒëª©ë¡ ë¡œë”© ì˜¤ë¥˜:', error);
                updateStatus('âŒ ì¬ìƒëª©ë¡ ë¡œë”© ì‹¤íŒ¨', 'text-red-600');
                alert('ì¬ìƒëª©ë¡ ë¡œë”© ì‹¤íŒ¨: ' + error.message);
                return [];
            }
        }

        // ë¹„ë””ì˜¤ í†µê³„ ê°€ì ¸ì˜¤ê¸°
        async function fetchVideoStats(videoIds) {
            updateStatus('ì¡°íšŒìˆ˜ ìˆ˜ì§‘ ì¤‘...', 'text-blue-600 pulse');
            
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoIds.join(',')}&key=${YOUTUBE_API_KEY}`
                );
                
                if (!response.ok) {
                    throw new Error('API ìš”ì²­ ì‹¤íŒ¨: ' + response.status);
                }
                
                const data = await response.json();
                
                const videos = data.items.map(item => {
                    const videoId = item.id;
                    const currentViews = parseInt(item.statistics.viewCount);
                    const previousViews = previousData[videoId] || currentViews;
                    const change = currentViews - previousViews;
                    
                    return {
                        videoId: videoId,
                        title: item.snippet.title,
                        currentViews: currentViews,
                        previousViews: previousViews,
                        change: change,
                        timestamp: new Date().toISOString()
                    };
                });
                
                return videos;
            } catch (error) {
                console.error('ì¡°íšŒìˆ˜ ìˆ˜ì§‘ ì˜¤ë¥˜:', error);
                updateStatus('âŒ ì¡°íšŒìˆ˜ ìˆ˜ì§‘ ì‹¤íŒ¨', 'text-red-600');
                alert('ì¡°íšŒìˆ˜ ìˆ˜ì§‘ ì‹¤íŒ¨: ' + error.message);
                return [];
            }
        }

        // ì „ì²´ ë°ì´í„° ë¡œë“œ
        async function loadPlaylistData() {
            const videoIds = await fetchPlaylistVideos();
            
            if (videoIds.length === 0) {
                return;
            }
            
            const stats = await fetchVideoStats(videoIds);
            
            if (stats.length > 0) {
                videosData = stats;
                
                // ì˜ìƒ ìˆ˜ ì—…ë°ì´íŠ¸
                document.getElementById('videoCount').textContent = stats.length;
                
                // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
                const now = new Date();
                document.getElementById('lastUpdate').textContent = formatTime(now);
                
                updateStatus('âœ“ ì—…ë°ì´íŠ¸ ì™„ë£Œ', 'text-emerald-600');
                renderView();
                
                // Firebaseì— ìë™ ì €ì¥
                await saveToFirebase();
            }
        }

        // ë·° ë Œë”ë§
        function renderView() {
            const sorted = [...videosData].sort((a, b) => b.change - a.change);

            if (currentViewMode === 'card') {
                renderCardView(sorted);
            } else {
                renderTableView(sorted);
            }
        }

        // ì¹´ë“œ ë·° ë Œë”ë§
        function renderCardView(videos) {
            const cardView = document.getElementById('cardView');
            
            cardView.innerHTML = videos.map((video, index) => {
                const rankIcon = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : index + 1;
                const changeColor = video.change > 0 ? 'text-emerald-600' : video.change < 0 ? 'text-red-600' : 'text-gray-600';
                const changeSign = video.change > 0 ? '+' : '';
                
                return `
                    <div class="glass-effect border-2 border-teal-200 rounded-2xl p-4 shadow-lg hover:shadow-xl transition-all">
                        <div class="flex items-start gap-3 mb-3">
                            <div class="text-2xl flex-shrink-0">${rankIcon}</div>
                            <div class="flex-1 min-w-0">
                                <h3 class="font-bold text-gray-800 text-sm mb-1 line-clamp-2">${video.title}</h3>
                                <a href="https://www.youtube.com/watch?v=${video.videoId}" target="_blank" class="text-xs text-teal-600 hover:text-teal-700 underline">
                                    YouTubeì—ì„œ ë³´ê¸° â†’
                                </a>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-teal-50 to-cyan-50 rounded-xl p-4 mb-3 border-2 border-teal-300 shadow">
                            <div class="text-center">
                                <div class="text-xs font-semibold text-gray-600 mb-2">í˜„ì¬ ì¡°íšŒìˆ˜</div>
                                <div class="text-4xl font-black gradient-text mb-2">
                                    ${video.currentViews.toLocaleString()}
                                </div>
                                <div class="inline-flex items-center gap-1 px-3 py-1 bg-white border-2 border-gray-300 rounded-full">
                                    <span class="text-sm font-bold ${changeColor}">
                                        ${changeSign}${video.change.toLocaleString()}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-white rounded-lg p-3 border-2 border-gray-200 shadow">
                                <div class="text-xs text-gray-500 mb-1 font-semibold">ì´ì „</div>
                                <div class="text-sm font-bold text-gray-700">${video.previousViews.toLocaleString()}</div>
                            </div>
                            <div class="bg-gradient-to-br from-emerald-50 to-green-50 rounded-lg p-3 border-2 border-emerald-300 shadow">
                                <div class="text-xs text-emerald-600 mb-1 font-semibold">ë³€í™”</div>
                                <div class="text-sm font-bold ${changeColor}">${changeSign}${video.change.toLocaleString()}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            cardView.classList.remove('hidden');
            document.getElementById('tableView').classList.add('hidden');
        }

        // í…Œì´ë¸” ë·° ë Œë”ë§
        function renderTableView(videos) {
            const tableView = document.getElementById('tableView');
            
            tableView.innerHTML = `
                <div class="glass-effect border-2 border-teal-200 rounded-2xl overflow-hidden shadow-lg">
                    <div class="bg-gradient-to-r from-teal-100 to-cyan-100 border-b-2 border-teal-300 p-3 grid grid-cols-4 gap-2 text-xs font-bold text-gray-700">
                        <div>ì˜ìƒëª…</div>
                        <div class="text-right">ì´ì „</div>
                        <div class="text-right">í˜„ì¬</div>
                        <div class="text-right text-teal-700">ë³€í™”</div>
                    </div>
                    <div>
                        ${videos.map((video, index) => {
                            const rankIcon = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : index + 1;
                            const changeColor = video.change > 0 ? 'text-emerald-700' : video.change < 0 ? 'text-red-700' : 'text-gray-700';
                            const changeSign = video.change > 0 ? '+' : '';
                            
                            return `
                                <div class="p-3 border-b border-teal-100 ${index < 3 ? 'bg-teal-50/50' : 'bg-white/50'} hover:bg-teal-50 transition-all">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-lg">${rankIcon}</span>
                                        <span class="text-gray-800 text-sm font-semibold flex-1 line-clamp-1">${video.title}</span>
                                    </div>
                                    <div class="grid grid-cols-3 gap-2 text-xs">
                                        <div class="text-right">
                                            <div class="text-gray-500 mb-0.5 font-semibold">ì´ì „</div>
                                            <div class="text-gray-700 font-mono font-bold">${video.previousViews.toLocaleString()}</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-teal-600 mb-0.5 font-semibold">í˜„ì¬</div>
                                            <div class="text-teal-700 font-mono font-bold">${video.currentViews.toLocaleString()}</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="${changeColor} mb-0.5 font-semibold">ë³€í™”</div>
                                            <div class="${changeColor} font-mono font-black text-base">${changeSign}${video.change.toLocaleString()}</div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            tableView.classList.remove('hidden');
            document.getElementById('cardView').classList.add('hidden');
        }

        // ë·° ëª¨ë“œ ë³€ê²½
        window.setViewMode = function(mode) {
            currentViewMode = mode;
            
            const cardBtn = document.getElementById('cardViewBtn');
            const tableBtn = document.getElementById('tableViewBtn');
            
            if (mode === 'card') {
                cardBtn.className = 'flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-gradient-to-r from-teal-400 to-cyan-400 text-white shadow-lg';
                tableBtn.className = 'flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-white text-gray-600 shadow';
            } else {
                cardBtn.className = 'flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-white text-gray-600 shadow';
                tableBtn.className = 'flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-gradient-to-r from-teal-400 to-cyan-400 text-white shadow-lg';
            }
            
            if (videosData.length > 0) {
                renderView();
            }
        };

        // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨
        window.manualRefresh = async function() {
            if (videosData.length === 0) {
                alert('ë¨¼ì € "ì¬ìƒëª©ë¡ ë¡œë“œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!');
                return;
            }
            
            // í˜„ì¬ ì¡°íšŒìˆ˜ë¥¼ ì´ì „ ë°ì´í„°ë¡œ ì €ì¥
            videosData.forEach(v => {
                previousData[v.videoId] = v.currentViews;
            });
            
            await loadPlaylistData();
        };

        // ì¬ìƒëª©ë¡ ë¡œë“œ
        window.loadPlaylist = async function() {
            await loadPlaylistData();
        };

        // Firebase ì €ì¥
        window.saveToFirebase = async function() {
            if (videosData.length === 0) {
                alert('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì¬ìƒëª©ë¡ì„ ë¡œë“œí•˜ì„¸ìš”.');
                return;
            }
            
            try {
                const timestamp = new Date().toISOString();
                const dataToSave = {
                    timestamp: timestamp,
                    videos: videosData
                };
                
                await set(ref(database, 'overnight/live/' + Date.now()), dataToSave);
                
                // ìµœì‹  ë°ì´í„°ë„ ì €ì¥
                await set(ref(database, 'overnight/live/latest'), dataToSave);
                
                updateStatus('âœ“ Firebase ì €ì¥ ì™„ë£Œ', 'text-emerald-600');
                
                setTimeout(() => {
                    updateStatus('âœ“ ì¤€ë¹„ ì™„ë£Œ', 'text-teal-600');
                }, 2000);
            } catch (error) {
                console.error('Firebase ì €ì¥ ì˜¤ë¥˜:', error);
                alert('Firebase ì €ì¥ ì‹¤íŒ¨: ' + error.message);
            }
        };

        // YouTubeì—ì„œ ì—´ê¸°
        window.openInYoutube = function() {
            window.open(`https://www.youtube.com/playlist?list=${PLAYLIST_ID}`, '_blank');
        };

        // Firebaseì—ì„œ ì´ì „ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadPreviousData() {
            try {
                const snapshot = await get(ref(database, 'overnight/live/latest'));
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    if (data.videos) {
                        data.videos.forEach(v => {
                            previousData[v.videoId] = v.currentViews;
                        });
                    }
                }
            } catch (error) {
                console.error('ì´ì „ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì´ˆê¸°í™”
        async function initialize() {
            updateStatus('ì´ˆê¸°í™” ì¤‘...', 'text-blue-600');
            await loadPreviousData();
            updateStatus('âœ“ ì¤€ë¹„ ì™„ë£Œ', 'text-emerald-600');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        initialize();
    </script>
</body>
</html>
