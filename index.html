<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ Overnight JangMinHo Live Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            min-height: 100vh;
        }
        .gradient-text {
            background: linear-gradient(to right, #14b8a6, #06b6d4, #0ea5e9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- ê³ ì • í—¤ë” -->
    <div class="sticky top-0 z-50 glass-effect border-b border-teal-200 shadow-xl">
        <div class="p-4">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-2">
                    <div class="bg-gradient-to-r from-teal-400 to-cyan-400 p-2 rounded-lg shadow-lg">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-base font-bold text-gray-800">ğŸµ Overnight Live</h1>
                        <p class="text-xs text-teal-600">11/8 PM7 â†’ 11/9 AM7</p>
                    </div>
                </div>
                
                <!-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
                <button onclick="manualRefresh()" class="bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-bold py-2 px-3 md:px-4 rounded-lg shadow-lg hover:shadow-xl transition-all text-sm md:text-base">
                    ğŸ”„ ìƒˆë¡œê³ ì¹¨
                </button>
            </div>

            <!-- ë·° ëª¨ë“œ ì „í™˜ -->
            <div class="flex gap-2 mb-3">
                <button id="cardViewBtn" onclick="setViewMode('card')" class="flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-gradient-to-r from-teal-400 to-cyan-400 text-white shadow-lg">
                    ì¹´ë“œë·°
                </button>
                <button id="tableViewBtn" onclick="setViewMode('table')" class="flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-white text-gray-600 shadow">
                    í…Œì´ë¸”ë·°
                </button>
            </div>

            <!-- ìƒíƒœ í‘œì‹œ -->
            <div class="grid grid-cols-3 gap-2 mb-3">
                <div class="bg-gradient-to-br from-teal-50 to-cyan-50 border-2 border-teal-300 rounded-lg p-2 text-center shadow">
                    <div class="text-xs text-teal-700 font-semibold">ì—…ë°ì´íŠ¸</div>
                    <div class="text-xs md:text-sm font-black text-teal-600" id="lastUpdate">--:--</div>
                </div>
                <div class="bg-gradient-to-br from-emerald-50 to-green-50 border-2 border-emerald-300 rounded-lg p-2 text-center shadow">
                    <div class="text-xs text-emerald-700 font-semibold">ì˜ìƒ ìˆ˜</div>
                    <div class="text-xs md:text-sm font-black text-emerald-600" id="videoCount">20</div>
                </div>
                <div class="bg-gradient-to-br from-rose-50 to-pink-50 border-2 border-rose-300 rounded-lg p-2 text-center shadow">
                    <div class="text-xs text-rose-700 font-semibold">ì´ ì¦ê°€</div>
                    <div class="text-xs md:text-sm font-black text-rose-600" id="totalChange">21,639</div>
                </div>
            </div>

            <!-- ì—°ê²° ìƒíƒœ -->
            <div class="text-center">
                <span id="connectionStatus" class="text-xs text-gray-500">ì¤€ë¹„ ì™„ë£Œ</span>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="p-4">
        <!-- PC: ì¢Œìš° 2ë‹¨ / ëª¨ë°”ì¼: ì„¸ë¡œ ìŠ¤íƒ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <!-- ì™¼ìª½: ì¬ìƒëª©ë¡ í”Œë ˆì´ì–´ (ëª¨ë°”ì¼ì—ì„œëŠ” ìœ„) -->
            <div class="lg:sticky lg:top-24 lg:self-start order-1 lg:order-1">
                <div class="glass-effect border-2 border-teal-300 rounded-2xl p-4 shadow-lg">
                    <h2 class="text-lg font-bold text-gray-800 mb-2">ğŸµ ì¬ìƒëª©ë¡</h2>
                    <p class="text-xs text-gray-600 mb-3">Overnight JangMinHo</p>
                    
                    <!-- YouTube í”Œë ˆì´ì–´ -->
                    <div class="relative" style="padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 15px; box-shadow: 0 10px 30px rgba(45, 212, 191, 0.3);">
                        <iframe 
                            id="player" 
                            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"
                            src="https://www.youtube.com/embed/videoseries?list=PLfuYGpnnSBu24ryeO51pagt62smucmmGv&autoplay=0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                            allowfullscreen>
                        </iframe>
                    </div>

                    <!-- YouTubeì—ì„œ ì—´ê¸° -->
                    <button onclick="openInYoutube()" class="mt-3 w-full bg-gradient-to-r from-red-500 to-rose-500 text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-xl transition-all">
                        ğŸ“º YouTubeì—ì„œ ì—´ê¸°
                    </button>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ì¡°íšŒìˆ˜ ì¶”ì  (ëª¨ë°”ì¼ì—ì„œëŠ” ì•„ë˜) -->
            <div class="order-2 lg:order-2">
                <div class="glass-effect border-2 border-teal-300 rounded-2xl p-4 shadow-lg mb-4">
                    <h2 class="text-lg font-bold text-gray-800 mb-2">ğŸ“Š ì¡°íšŒìˆ˜ ì¶”ì </h2>
                    <p class="text-xs text-gray-600">8ì¼ PM7 â†’ 9ì¼ AM7 ë³€í™”ëŸ‰ + ì‹¤ì‹œê°„</p>
                </div>

                <!-- ì¹´ë“œ ë·° -->
                <div id="cardView" class="space-y-3"></div>
                
                <!-- í…Œì´ë¸” ë·° -->
                <div id="tableView" class="hidden"></div>

                <!-- Firebase ì €ì¥ ë²„íŠ¼ -->
                <div class="mt-6">
                    <button onclick="saveToFirebase()" class="w-full bg-gradient-to-r from-pink-400 to-rose-400 text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-xl transition-all">
                        ğŸ’¾ Firebase ì €ì¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyBDOcjC6DNtM-8xQS6PNZqV7yAFq4PMCR8",
            authDomain: "always-88981.firebaseapp.com",
            projectId: "always-88981",
            storageBucket: "always-88981.firebasestorage.app",
            messagingSenderId: "915000956041",
            appId: "1:915000956041:web:490e0668c560aafd0e6258",
            measurementId: "G-WRWS6GGV8L",
            databaseURL: "https://always-88981-default-rtdb.firebaseio.com"
        };

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // YouTube API ì„¤ì •
        const YOUTUBE_API_KEY = 'AIzaSyBuoonh-2xdqGo8nQfrTEQBeNDfoL-udfU';
        const PLAYLIST_ID = 'PLfuYGpnnSBu24ryeO51pagt62smucmmGv';

        let currentViewMode = 'card';
        let videosData = [];

        // ì´ˆê¸° ê³ ì • ë°ì´í„° (11ì›” 8ì¼ PM7 / 11ì›” 9ì¼ AM7)
        const INITIAL_DATA = {
            '8PM7': {
                'í™€ë¡œëœ ì‚¬ë‘ (ì•ˆë¬´)': 60065,
                'ë‚´ê²Œ ë‚¨ì€ ì‚¬ë‘ì„ ë“œë¦´ê²Œìš”(OM)': 81065,
                'ì¥ë¯¼í˜¸ìœ íŠœë¸Œ ì‹œì‘ EP.00': 31225,
                'ì¥í•˜ë‹¤ ì¥ë¯¼í˜¸ EP.01': 33629,
                'í™€ë¡œëœì‚¬ë‘(OM )': 81037,
                'í™€ë¡œëœ ì‚¬ë‘': 58753,
                'í•œê³„ë ¹': 93128,
                'í•œê³„ë ¹ (OM )': 139011,
                'ë‚´ ë§ˆìŒì— ë¹„ì¹œ ë‚´ ëª¨ìŠµ': 148768,
                'ë‚´ ê³ì— ìˆì–´ì£¼ | ì•„ì™¸ë…¹ìŒì‹¤': 351825,
                'ë‚´ ê³ì— ìˆì–´ì£¼ (OM)': 149258,
                'ë‚´ ê³ì— ìˆì–´ì£¼': 41155,
                'ë‚´ê²Œ ë‚¨ì€ ì‚¬ë‘ì„ ë“œë¦´ê²Œìš”': 120249,
                'ê·¸ì € ì¹œêµ¬': 102779,
                'ê·¸ë‚ ': 78698,
                'ì‚¬ë‘ì˜ í‹°í‚¤íƒ€ì¹´ ìˆ˜íŠ¸ëŒ„ìŠ¤': 803843,
                'ëŒ€ê°€ìˆ˜ì™€ ëŒ€í˜•ê²¬ì˜ ë§Œë‚¨': 24456,
                'ëŒ€ìì—°ì—ì„œ ì¶¤ëŠ” í™€ë¡œëœ ì‚¬ë‘': 34153,
                'ìŠìœ¼ë¦¬ì˜¤': 337477,
                'ë‚´ ì´ë¦„ ì•„ì‹œì£ ': 8896970
            },
            '9AM7': {
                'í™€ë¡œëœ ì‚¬ë‘ (ì•ˆë¬´)': 61359,
                'ë‚´ê²Œ ë‚¨ì€ ì‚¬ë‘ì„ ë“œë¦´ê²Œìš”(OM)': 82475,
                'ì¥ë¯¼í˜¸ìœ íŠœë¸Œ ì‹œì‘ EP.00': 31659,
                'ì¥í•˜ë‹¤ ì¥ë¯¼í˜¸ EP.01': 34381,
                'í™€ë¡œëœì‚¬ë‘(OM )': 82253,
                'í™€ë¡œëœ ì‚¬ë‘': 59218,
                'í•œê³„ë ¹': 93548,
                'í•œê³„ë ¹ (OM )': 140479,
                'ë‚´ ë§ˆìŒì— ë¹„ì¹œ ë‚´ ëª¨ìŠµ': 150022,
                'ë‚´ ê³ì— ìˆì–´ì£¼ | ì•„ì™¸ë…¹ìŒì‹¤': 352192,
                'ë‚´ ê³ì— ìˆì–´ì£¼ (OM)': 150533,
                'ë‚´ ê³ì— ìˆì–´ì£¼': 41450,
                'ë‚´ê²Œ ë‚¨ì€ ì‚¬ë‘ì„ ë“œë¦´ê²Œìš”': 121686,
                'ê·¸ì € ì¹œêµ¬': 103670,
                'ê·¸ë‚ ': 79429,
                'ì‚¬ë‘ì˜ í‹°í‚¤íƒ€ì¹´ ìˆ˜íŠ¸ëŒ„ìŠ¤': 804213,
                'ëŒ€ê°€ìˆ˜ì™€ ëŒ€í˜•ê²¬ì˜ ë§Œë‚¨': 25490,
                'ëŒ€ìì—°ì—ì„œ ì¶¤ëŠ” í™€ë¡œëœ ì‚¬ë‘': 36839,
                'ìŠìœ¼ë¦¬ì˜¤': 338705,
                'ë‚´ ì´ë¦„ ì•„ì‹œì£ ': 8898779
            }
        };

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(message, color = 'text-teal-600') {
            const status = document.getElementById('connectionStatus');
            status.textContent = message;
            status.className = `text-xs font-semibold ${color}`;
        }

        // ì‹œê°„ í¬ë§·
        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // ì œëª© ì •ê·œí™” (ë¹„êµìš©)
        function normalizeTitle(title) {
            return title.toLowerCase()
                .replace(/\s+/g, '')
                .replace(/[()]/g, '')
                .replace(/official/gi, '')
                .replace(/mv/gi, '')
                .replace(/ì¥ë¯¼í˜¸/g, '')
                .replace(/jangminho/gi, '');
        }

        // ì¬ìƒëª©ë¡ ë¹„ë””ì˜¤ ê°€ì ¸ì˜¤ê¸°
        async function fetchPlaylistVideos() {
            updateStatus('ì¬ìƒëª©ë¡ ë¡œë”© ì¤‘...', 'text-blue-600 pulse');
            
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${PLAYLIST_ID}&key=${YOUTUBE_API_KEY}`
                );
                
                if (!response.ok) {
                    throw new Error('API ìš”ì²­ ì‹¤íŒ¨: ' + response.status);
                }
                
                const data = await response.json();
                return data.items;
            } catch (error) {
                console.error('ì¬ìƒëª©ë¡ ë¡œë”© ì˜¤ë¥˜:', error);
                updateStatus('âŒ ì¬ìƒëª©ë¡ ë¡œë”© ì‹¤íŒ¨', 'text-red-600');
                return [];
            }
        }

        // ë¹„ë””ì˜¤ í†µê³„ ê°€ì ¸ì˜¤ê¸°
        async function fetchVideoStats(videoIds) {
            updateStatus('ì¡°íšŒìˆ˜ ìˆ˜ì§‘ ì¤‘...', 'text-blue-600 pulse');
            
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoIds.join(',')}&key=${YOUTUBE_API_KEY}`
                );
                
                if (!response.ok) {
                    throw new Error('API ìš”ì²­ ì‹¤íŒ¨: ' + response.status);
                }
                
                const data = await response.json();
                return data.items;
            } catch (error) {
                console.error('ì¡°íšŒìˆ˜ ìˆ˜ì§‘ ì˜¤ë¥˜:', error);
                updateStatus('âŒ ì¡°íšŒìˆ˜ ìˆ˜ì§‘ ì‹¤íŒ¨', 'text-red-600');
                return [];
            }
        }

        // ì „ì²´ ë°ì´í„° ë¡œë“œ
        async function loadPlaylistData() {
            const playlistItems = await fetchPlaylistVideos();
            
            if (playlistItems.length === 0) {
                return;
            }
            
            const videoIds = playlistItems.map(item => item.snippet.resourceId.videoId);
            const videoStats = await fetchVideoStats(videoIds);
            
            if (videoStats.length > 0) {
                videosData = videoStats.map(item => {
                    const videoId = item.id;
                    const title = item.snippet.title;
                    const realtime = parseInt(item.statistics.viewCount);
                    
                    // ê³ ì • ë°ì´í„°ì—ì„œ ë§¤ì¹­ë˜ëŠ” ì œëª© ì°¾ê¸°
                    let pm7 = null;
                    let am7 = null;
                    
                    const normalizedTitle = normalizeTitle(title);
                    
                    for (const [key, value] of Object.entries(INITIAL_DATA['8PM7'])) {
                        if (normalizeTitle(key).includes(normalizedTitle) || normalizedTitle.includes(normalizeTitle(key))) {
                            pm7 = value;
                            am7 = INITIAL_DATA['9AM7'][key];
                            break;
                        }
                    }
                    
                    // ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ í˜„ì¬ ì¡°íšŒìˆ˜ ì‚¬ìš©
                    if (pm7 === null) {
                        pm7 = realtime;
                        am7 = realtime;
                    }
                    
                    const change = am7 - pm7;
                    
                    return {
                        videoId: videoId,
                        title: title,
                        pm7: pm7,           // 8ì¼ PM 7ì‹œ (ê³ ì •)
                        am7: am7,           // 9ì¼ AM 7ì‹œ (ê³ ì •)
                        realtime: realtime, // ì‹¤ì‹œê°„
                        change: change,     // ì¦ê° (AM7 - PM7)
                        timestamp: new Date().toISOString()
                    };
                });
                
                // ì˜ìƒ ìˆ˜ ì—…ë°ì´íŠ¸
                document.getElementById('videoCount').textContent = videosData.length;
                
                // ì´ ì¦ê°€ëŸ‰ ê³„ì‚°
                const totalChange = videosData.reduce((sum, v) => sum + v.change, 0);
                document.getElementById('totalChange').textContent = totalChange.toLocaleString();
                
                // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
                const now = new Date();
                document.getElementById('lastUpdate').textContent = formatTime(now);
                
                updateStatus('âœ“ ì—…ë°ì´íŠ¸ ì™„ë£Œ', 'text-emerald-600');
                renderView();
            }
        }

        // ë·° ë Œë”ë§
        function renderView() {
            const sorted = [...videosData].sort((a, b) => b.change - a.change);

            if (currentViewMode === 'card') {
                renderCardView(sorted);
            } else {
                renderTableView(sorted);
            }
        }

        // ì¹´ë“œ ë·° ë Œë”ë§
        function renderCardView(videos) {
            const cardView = document.getElementById('cardView');
            
            cardView.innerHTML = videos.map((video, index) => {
                const rankIcon = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}`;
                const changeColor = video.change > 0 ? 'text-emerald-600' : video.change < 0 ? 'text-red-600' : 'text-gray-600';
                const changeSign = video.change > 0 ? '+' : '';
                
                return `
                    <div class="glass-effect border-2 border-teal-200 rounded-2xl p-3 md:p-4 shadow-lg hover:shadow-xl transition-all">
                        <div class="flex items-start gap-2 md:gap-3 mb-3">
                            <div class="text-xl md:text-2xl flex-shrink-0">${rankIcon}</div>
                            <div class="flex-1 min-w-0">
                                <h3 class="font-bold text-gray-800 text-sm md:text-base mb-1 line-clamp-2">${video.title}</h3>
                                <a href="https://www.youtube.com/watch?v=${video.videoId}" target="_blank" class="text-xs text-teal-600 hover:text-teal-700 underline">
                                    YouTubeì—ì„œ ë³´ê¸° â†’
                                </a>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-2 mb-3">
                            <div class="bg-gradient-to-br from-purple-50 to-violet-50 rounded-lg p-2 md:p-3 border-2 border-purple-200 shadow text-center">
                                <div class="text-xs text-purple-600 mb-1 font-semibold">8ì¼ PM7</div>
                                <div class="text-xs md:text-sm font-bold text-purple-700">${video.pm7.toLocaleString()}</div>
                            </div>
                            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-lg p-2 md:p-3 border-2 border-blue-200 shadow text-center">
                                <div class="text-xs text-blue-600 mb-1 font-semibold">9ì¼ AM7</div>
                                <div class="text-xs md:text-sm font-bold text-blue-700">${video.am7.toLocaleString()}</div>
                            </div>
                            <div class="bg-gradient-to-br from-emerald-50 to-green-50 rounded-lg p-2 md:p-3 border-2 border-emerald-300 shadow text-center">
                                <div class="text-xs text-emerald-600 mb-1 font-semibold">ì¦ê°</div>
                                <div class="text-xs md:text-sm font-bold ${changeColor}">${changeSign}${video.change.toLocaleString()}</div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-teal-50 to-cyan-50 rounded-xl p-3 md:p-4 border-2 border-teal-300 shadow">
                            <div class="text-center">
                                <div class="text-xs font-semibold text-gray-600 mb-2">ì‹¤ì‹œê°„ ì¡°íšŒìˆ˜</div>
                                <div class="text-2xl md:text-3xl font-black gradient-text">
                                    ${video.realtime.toLocaleString()}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            cardView.classList.remove('hidden');
            document.getElementById('tableView').classList.add('hidden');
        }

        // í…Œì´ë¸” ë·° ë Œë”ë§
        function renderTableView(videos) {
            const tableView = document.getElementById('tableView');
            
            tableView.innerHTML = `
                <div class="glass-effect border-2 border-teal-200 rounded-2xl overflow-hidden shadow-lg">
                    <div class="bg-gradient-to-r from-teal-100 to-cyan-100 border-b-2 border-teal-300 p-3 grid grid-cols-5 gap-2 text-xs font-bold text-gray-700">
                        <div>ì˜ìƒëª…</div>
                        <div class="text-right">8ì¼ PM7</div>
                        <div class="text-right">9ì¼ AM7</div>
                        <div class="text-right text-emerald-700">ì¦ê°</div>
                        <div class="text-right text-teal-700">ì‹¤ì‹œê°„</div>
                    </div>
                    <div>
                        ${videos.map((video, index) => {
                            const rankIcon = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}`;
                            const changeColor = video.change > 0 ? 'text-emerald-700' : video.change < 0 ? 'text-red-700' : 'text-gray-700';
                            const changeSign = video.change > 0 ? '+' : '';
                            
                            return `
                                <div class="p-2 md:p-3 border-b border-teal-100 ${index < 3 ? 'bg-teal-50/50' : 'bg-white/50'} hover:bg-teal-50 transition-all">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-base md:text-lg">${rankIcon}</span>
                                        <a href="https://www.youtube.com/watch?v=${video.videoId}" target="_blank" class="text-gray-800 text-xs md:text-sm font-semibold flex-1 line-clamp-1 hover:text-teal-600">
                                            ${video.title}
                                        </a>
                                    </div>
                                    <div class="grid grid-cols-4 gap-2 text-xs">
                                        <div class="text-right">
                                            <div class="text-purple-600 mb-0.5 font-semibold">8ì¼ PM7</div>
                                            <div class="text-purple-700 font-mono font-bold">${video.pm7.toLocaleString()}</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-blue-600 mb-0.5 font-semibold">9ì¼ AM7</div>
                                            <div class="text-blue-700 font-mono font-bold">${video.am7.toLocaleString()}</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="${changeColor} mb-0.5 font-semibold">ì¦ê°</div>
                                            <div class="${changeColor} font-mono font-black">${changeSign}${video.change.toLocaleString()}</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-teal-600 mb-0.5 font-semibold">ì‹¤ì‹œê°„</div>
                                            <div class="text-teal-700 font-mono font-black">${video.realtime.toLocaleString()}</div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            tableView.classList.remove('hidden');
            document.getElementById('cardView').classList.add('hidden');
        }

        // ë·° ëª¨ë“œ ë³€ê²½
        window.setViewMode = function(mode) {
            currentViewMode = mode;
            
            const cardBtn = document.getElementById('cardViewBtn');
            const tableBtn = document.getElementById('tableViewBtn');
            
            if (mode === 'card') {
                cardBtn.className = 'flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-gradient-to-r from-teal-400 to-cyan-400 text-white shadow-lg';
                tableBtn.className = 'flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-white text-gray-600 shadow';
            } else {
                cardBtn.className = 'flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-white text-gray-600 shadow';
                tableBtn.className = 'flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-all bg-gradient-to-r from-teal-400 to-cyan-400 text-white shadow-lg';
            }
            
            if (videosData.length > 0) {
                renderView();
            }
        };

        // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨
        window.manualRefresh = async function() {
            await loadPlaylistData();
        };

        // Firebase ì €ì¥
        window.saveToFirebase = async function() {
            if (videosData.length === 0) {
                alert('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
                return;
            }
            
            try {
                const now = new Date();
                
                const dataToSave = {
                    timestamp: now.toISOString(),
                    videos: videosData
                };
                
                await set(ref(database, 'overnight/snapshots/' + Date.now()), dataToSave);
                await set(ref(database, 'overnight/latest'), dataToSave);
                
                updateStatus('âœ“ Firebase ì €ì¥ ì™„ë£Œ', 'text-emerald-600');
                
                setTimeout(() => {
                    updateStatus('âœ“ ì¤€ë¹„ ì™„ë£Œ', 'text-teal-600');
                }, 2000);
            } catch (error) {
                console.error('Firebase ì €ì¥ ì˜¤ë¥˜:', error);
                alert('Firebase ì €ì¥ ì‹¤íŒ¨: ' + error.message);
            }
        };

        // YouTubeì—ì„œ ì—´ê¸°
        window.openInYoutube = function() {
            window.open(`https://www.youtube.com/playlist?list=${PLAYLIST_ID}`, '_blank');
        };

        // ì´ˆê¸°í™”
        async function initialize() {
            updateStatus('ì´ˆê¸°í™” ì¤‘...', 'text-blue-600');
            await loadPlaylistData();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        initialize();
    </script>
</body>
</html>
